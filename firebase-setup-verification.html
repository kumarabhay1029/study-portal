<!DOCTYPE html>
<html>
<head>
    <title>🔥 Firebase Setup Verification</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto; 
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status { 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 5px solid;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border-color: #28a745;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border-color: #dc3545;
        }
        .warning { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffc107;
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border-color: #17a2b8;
        }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        .code { 
            background: #f8f9fa; 
            padding: 12px; 
            border-radius: 6px; 
            font-family: monospace; 
            border: 1px solid #e9ecef;
        }
        h1 { color: #333; margin-bottom: 20px; }
        h2 { color: #555; margin-top: 30px; }
        .step { 
            background: #f8f9fa; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔥 Firebase Setup Verification</h1>
        <p>This tool will help you verify and fix your Firebase configuration for GitHub Pages.</p>
        
        <div id="status"></div>
        
        <h2>🧪 Verification Tests</h2>
        <button onclick="runAllTests()">🚀 Run All Tests</button>
        <button onclick="testFirebaseConnection()">Test Firebase Connection</button>
        <button onclick="testAuthentication()">Test Authentication</button>
        <button onclick="testDomainAuth()">Test Domain Authorization</button>
        
        <h2>🔧 Setup Instructions</h2>
        
        <div class="step">
            <h3>Step 1: Verify Firebase Project</h3>
            <p>Current project: <code>f1site-b35c6</code></p>
            <p>Go to <a href="https://console.firebase.google.com/project/f1site-b35c6" target="_blank">Firebase Console</a></p>
        </div>
        
        <div class="step">
            <h3>Step 2: Enable Authentication</h3>
            <p>1. In Firebase Console, click "Authentication" → "Get started"</p>
            <p>2. Click "Sign-in method" tab</p>
            <p>3. Enable "Email/Password" provider</p>
        </div>
        
        <div class="step">
            <h3>Step 3: Add Authorized Domain</h3>
            <p>1. Go to Authentication → Settings</p>
            <p>2. Scroll to "Authorized domains"</p>
            <p>3. Click "Add domain" and add: <code>kumarabhay1029.github.io</code></p>
        </div>
        
        <div class="step">
            <h3>Step 4: Test Your Setup</h3>
            <p>1. Push changes to GitHub</p>
            <p>2. Wait 2-3 minutes for deployment</p>
            <p>3. Test login on your GitHub Pages site</p>
        </div>
        
        <h2>📊 Configuration Details</h2>
        <div id="configDetails"></div>
    </div>

    <!-- Load Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAMOoKFc6PeWoCaEa0-iZ1o2xer3capkyQ",
            authDomain: "f1site-b35c6.firebaseapp.com",
            projectId: "f1site-b35c6",
            storageBucket: "f1site-b35c6.firebasestorage.app",
            messagingSenderId: "1077434047400",
            appId: "1:1077434047400:web:0e30d9b02540355a4b1b9d"
        };

        function addStatus(message, type) {
            const status = document.getElementById('status');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            status.appendChild(div);
        }

        function showConfigDetails() {
            const details = document.getElementById('configDetails');
            details.innerHTML = `
                <div class="code">
                    <strong>Current Domain:</strong> ${window.location.hostname}<br>
                    <strong>Current URL:</strong> ${window.location.href}<br>
                    <strong>Project ID:</strong> ${firebaseConfig.projectId}<br>
                    <strong>Auth Domain:</strong> ${firebaseConfig.authDomain}<br>
                    <strong>Expected GitHub Pages URL:</strong> kumarabhay1029.github.io/study-portal/
                </div>
            `;
        }

        function testFirebaseConnection() {
            addStatus('🔄 Testing Firebase connection...', 'info');
            
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                addStatus('✅ Firebase SDK loaded and initialized successfully!', 'success');
                addStatus(`📍 Project: ${firebaseConfig.projectId}`, 'info');
                return true;
            } catch (error) {
                addStatus(`❌ Firebase connection failed: ${error.message}`, 'error');
                
                if (error.message.includes('api-key-not-valid')) {
                    addStatus(`🔧 SOLUTION: Add "${window.location.hostname}" to Firebase Authorized domains`, 'warning');
                }
                return false;
            }
        }

        function testAuthentication() {
            addStatus('🔄 Testing Firebase Authentication...', 'info');
            
            try {
                const auth = firebase.auth();
                addStatus('✅ Firebase Auth initialized successfully!', 'success');
                
                // Test auth state listener
                auth.onAuthStateChanged(function(user) {
                    if (user) {
                        addStatus('✅ User is signed in', 'success');
                    } else {
                        addStatus('ℹ️ No user signed in (expected for new setup)', 'info');
                    }
                });
                
                addStatus('✅ Authentication service is working!', 'success');
                return true;
                
            } catch (error) {
                addStatus(`❌ Authentication test failed: ${error.message}`, 'error');
                
                if (error.code === 'auth/operation-not-allowed') {
                    addStatus('🔧 SOLUTION: Enable Email/Password authentication in Firebase Console', 'warning');
                }
                return false;
            }
        }

        function testDomainAuth() {
            addStatus('🔄 Testing domain authorization...', 'info');
            
            const currentDomain = window.location.hostname;
            const expectedDomain = 'kumarabhay1029.github.io';
            
            if (currentDomain === expectedDomain) {
                addStatus('✅ Domain matches expected GitHub Pages domain', 'success');
            } else if (currentDomain === 'localhost' || currentDomain === '127.0.0.1') {
                addStatus('ℹ️ Running on localhost - this is fine for testing', 'info');
                addStatus(`🔧 Remember to add "${expectedDomain}" to Firebase Authorized domains`, 'warning');
            } else {
                addStatus(`⚠️ Unexpected domain: ${currentDomain}`, 'warning');
                addStatus(`🔧 Make sure to add "${currentDomain}" to Firebase Authorized domains`, 'warning');
            }
            
            // Test a simple auth operation to check domain authorization
            try {
                const auth = firebase.auth();
                
                // Try to check current user (this will trigger domain validation)
                const user = auth.currentUser;
                addStatus('✅ Domain authorization check passed', 'success');
                
            } catch (error) {
                if (error.code === 'auth/api-key-not-valid') {
                    addStatus(`❌ Domain not authorized: ${currentDomain}`, 'error');
                    addStatus('🔧 SOLUTION: Add this domain to Firebase Authorized domains in Console', 'warning');
                } else {
                    addStatus(`⚠️ Domain check inconclusive: ${error.message}`, 'warning');
                }
            }
        }

        function runAllTests() {
            addStatus('🚀 Running comprehensive Firebase setup verification...', 'info');
            
            const results = {
                connection: false,
                auth: false,
                domain: false
            };
            
            // Test connection
            results.connection = testFirebaseConnection();
            
            if (results.connection) {
                // Test authentication
                setTimeout(() => {
                    results.auth = testAuthentication();
                    
                    // Test domain
                    setTimeout(() => {
                        testDomainAuth();
                        
                        // Summary
                        setTimeout(() => {
                            if (results.connection && results.auth) {
                                addStatus('🎉 Setup verification complete! Your Firebase configuration looks good.', 'success');
                                addStatus('💡 If login still doesn\'t work, make sure the domain is authorized in Firebase Console.', 'info');
                            } else {
                                addStatus('⚠️ Some tests failed. Please follow the setup instructions above.', 'warning');
                            }
                        }, 1000);
                    }, 1000);
                }, 1000);
            }
        }

        // Initialize
        window.addEventListener('load', function() {
            showConfigDetails();
            addStatus('🔧 Firebase Setup Verification Tool Ready', 'info');
            addStatus('👆 Click "Run All Tests" to verify your configuration', 'info');
        });
    </script>
</body>
</html>
