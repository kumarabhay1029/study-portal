<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Detection Test</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
        }
        .error-log {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .test-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .success { color: #44ff44; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Error Detection & Debugging</h1>
        
        <p><strong>Note:</strong> This page doesn't have the main site's UI elements (tabs, modals, etc.), so some warnings about missing elements are expected and normal.</p>
        
        <div id="errorLog" class="error-log">Starting error detection tests...\n</div>
        
        <div>
            <button class="test-btn" onclick="testAuthSystem()">Test Auth System</button>
            <button class="test-btn" onclick="testTabSwitching()">Test Tab Switching</button>
            <button class="test-btn" onclick="testPasswordStrength()">Test Password Strength</button>
            <button class="test-btn" onclick="testMobileMenu()">Test Mobile Menu</button>
            <button class="test-btn" onclick="clearLog()">Clear Log</button>
        </div>
        
        <h3>üìä System Status:</h3>
        <div id="systemStatus">Loading...</div>
    </div>

    <!-- Load the main scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/study-portal-bundle.js"></script>
    
    <script>
        let logDiv = document.getElementById('errorLog');
        let statusDiv = document.getElementById('systemStatus');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : '';
            logDiv.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            logDiv.innerHTML = 'Log cleared...\n';
        }
        
        // Capture console errors
        window.addEventListener('error', function(e) {
            log(`ERROR: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            log(`PROMISE REJECTION: ${e.reason}`, 'error');
        });
        
        // Override console methods to capture logs
        const originalError = console.error;
        const originalLog = console.log;
        const originalWarn = console.warn;
        
        console.error = function(...args) {
            log(`CONSOLE ERROR: ${args.join(' ')}`, 'error');
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            log(`CONSOLE WARN: ${args.join(' ')}`, 'warning');
            originalWarn.apply(console, args);
        };
        
        function testAuthSystem() {
            log('üîê Testing Authentication System...');
            try {
                // Test Firebase readiness
                log(`Firebase Ready: ${window.firebaseReady}`);
                log(`Auth Available: ${!!window.auth}`);
                log(`Final Auth Available: ${!!window.finalAuth}`);
                
                // Test global functions
                const functions = ['showAuthTab', 'toggleMobileMenu', 'checkPasswordStrength', 'resetPassword', 'registerUser'];
                functions.forEach(func => {
                    if (window[func]) {
                        log(`‚úÖ ${func} function available`, 'success');
                    } else {
                        log(`‚ùå ${func} function missing`, 'error');
                    }
                });
                
                log('Auth system test completed', 'success');
            } catch (error) {
                log(`Auth test error: ${error.message}`, 'error');
            }
        }
        
        function testTabSwitching() {
            log('üîÑ Testing Tab Switching...');
            try {
                if (!window.showAuthTab) {
                    log('‚ùå showAuthTab function not available', 'error');
                    return;
                }
                
                // Test each tab
                ['login', 'register', 'forgot'].forEach(tab => {
                    try {
                        window.showAuthTab(tab);
                        log(`‚úÖ ${tab} tab switch successful`, 'success');
                    } catch (error) {
                        log(`‚ùå ${tab} tab switch failed: ${error.message}`, 'error');
                    }
                });
                
                log('Tab switching test completed', 'success');
            } catch (error) {
                log(`Tab switching test error: ${error.message}`, 'error');
            }
        }
        
        function testPasswordStrength() {
            log('üîí Testing Password Strength...');
            try {
                if (!window.checkPasswordStrength) {
                    log('‚ùå checkPasswordStrength function not available', 'error');
                    return;
                }
                
                const testPasswords = ['123', 'password', 'Password123!'];
                testPasswords.forEach(pwd => {
                    try {
                        const result = window.checkPasswordStrength(pwd);
                        log(`‚úÖ "${pwd}" -> ${result.text} (${result.percentage}%)`, 'success');
                    } catch (error) {
                        log(`‚ùå Password test failed for "${pwd}": ${error.message}`, 'error');
                    }
                });
                
                log('Password strength test completed', 'success');
            } catch (error) {
                log(`Password strength test error: ${error.message}`, 'error');
            }
        }
        
        function testMobileMenu() {
            log('üçî Testing Mobile Menu...');
            try {
                if (!window.toggleMobileMenu) {
                    log('‚ùå toggleMobileMenu function not available', 'error');
                    return;
                }
                
                // Test mobile menu elements
                const sidebar = document.querySelector('.sidebar');
                const overlay = document.querySelector('.mobile-backdrop');
                const button = document.querySelector('.mobile-menu-toggle');
                
                log(`Sidebar: ${sidebar ? '‚úÖ Found' : '‚ùå Missing'}`);
                log(`Overlay: ${overlay ? '‚úÖ Found' : '‚ùå Missing'}`);
                log(`Button: ${button ? '‚úÖ Found' : '‚ùå Missing'}`);
                
                log('Mobile menu test completed', 'success');
            } catch (error) {
                log(`Mobile menu test error: ${error.message}`, 'error');
            }
        }
        
        function updateSystemStatus() {
            const status = {
                firebaseReady: window.firebaseReady,
                authReady: window.finalAuth?.authReady,
                functionsLoaded: {
                    showAuthTab: !!window.showAuthTab,
                    toggleMobileMenu: !!window.toggleMobileMenu,
                    checkPasswordStrength: !!window.checkPasswordStrength,
                    resetPassword: !!window.resetPassword,
                    registerUser: !!window.registerUser
                }
            };
            
            statusDiv.innerHTML = `<pre>${JSON.stringify(status, null, 2)}</pre>`;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Error detection page loaded');
            setTimeout(() => {
                updateSystemStatus();
                testAuthSystem();
            }, 1000);
        });
    </script>
</body>
</html>
